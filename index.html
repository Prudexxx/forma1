<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>–°–æ–∑–¥–∞–Ω–∏–µ –¥–æ–≥–æ–≤–æ—Ä–∞</title>
<script src="https://cdn.jsdelivr.net/npm/html2pdf.js@0.10.1/dist/html2pdf.bundle.min.js"></script>
<style>
  #pdfPreview iframe {
    width: 100%;
    height: 80vh;
    border: none;
  }
  body {
    background-color: rgb(150, 78, 245);
    font-family: Arial, sans-serif;
    margin: 20px;
    font-size: 14px;
  }
  h1 {
    text-align: center;
    margin-bottom: 20px;
  }
  form {
    max-width: 600px;
    margin: 0 auto 20px auto;
  }
  label {
    display: block;
    margin-top: 10px;
  }
  input, select {
    background-color: rgb(218, 128, 125);
    width: 100%;
    padding: 8px;
    box-sizing: border-box;
  }
  button {
    background-color: rgb(223, 199, 68);
    margin-top: 15px;
    padding: 10px 20px;
    cursor: pointer;
  }
  #pdfPreview {
    margin-top: 20px;
  }
  #itemsTable {
    width: 100%;
    border-collapse: collapse;
    overflow-x: auto;
    display: block;
  }
  #itemsTable th, #itemsTable td {
    border: 1px solid #000;
    padding: 5px;
    text-align: center;
    min-width: 50px;
  }
  .deleteBtn {
    background: none;
    border: none;
    color: red;
    font-size: 20px;
    line-height: 1;
    cursor: pointer;
    padding: 0;
    margin: 0;
  }
  #discountCheckbox {
    appearance: none;
    -webkit-appearance: none;
    width: 25px;
    height: 25px;
    border: 2px solid #ccc;
    border-radius: 3px;
    background-color: rgb(218, 128, 125);
    cursor: pointer;
    position: relative;
  }
  #discountCheckbox:checked {
    background-color: #1974ec;
    border-color: #4CAF50;
  }
  #discountCheckbox:checked::after {
    content: '';
    position: absolute;
    top: 2px;
    left: 6px;
    width: 6px;
    height: 12px;
    border: solid rgb(138, 27, 27);
    border-width: 0 2px 2px 0;
    transform: rotate(45deg);
  }
</style>
</head>
<body>

<h1>–°–æ–∑–¥–∞—Ç—å –¥–æ–≥–æ–≤–æ—Ä</h1>

<form id="contractForm">
  <label>
    <p>–ù–∞–∏–º —É—Å–ª—É–≥–∏:</p>
    <input type="text" id="serviceName" placeholder="–ù–∞–∏–º" required>
  </label>
  <label>
    <p>–î–∞—Ç–∞:</p>
    <input type="date" id="date" required>
  </label>
  <label>
    <p>–ö–æ–ª-–≤–æ:</p>
    <input type="number" id="quantity" min="0" required>
  </label>
  <label>
    <p>–ï–¥:</p>
    <select id="unit" required>
      <option value="—Ç">—Ç</option>
      <option value="–º3">–º3</option>
       <option value="–º3">—à—Ç</option>
    </select>
  </label>
  <label>
    <p>–°—É–º–º–∞ (—Ä—É–±):</p>
    <input type="number" id="amount" min="0" required>
  </label>
  <label>
    <p>–ò–º—è –∑–∞–∫–∞–∑—á–∏–∫–∞:</p>
    <input type="text" id="customer" placeholder="–ò–≤–∞–Ω–æ–≤ –ò –ò" required>
  </label>
  <label>
    <p>–ê–¥—Ä–µ—Å:</p>
    <input type="text" id="address" placeholder="–ù–æ–≤–æ—Ç—Ä–∞–∫—Ç–æ–≤–∞—è, 13" required>
  </label>
  <label>
    <p>–¢–µ–ª–µ—Ñ–æ–Ω –∑–∞–∫–∞–∑—á–∏–∫–∞:</p>
    <input type="tel" id="customerPhone" placeholder="8-900-00-00" required>
  </label>
  
  <h3>–î–æ–±–∞–≤–∏—Ç—å –ø–æ–∑–∏—Ü–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤/—É—Å–ª—É–≥</h3>
  
  <button type="button" onclick="showAddItemForm()">–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä/—É—Å–ª—É–≥—É</button>
  
  <!-- –§–æ—Ä–º–∞ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤ -->
  <div id="additionalItemForm" style="display:none; margin-top:10px; padding:10px; border:1px solid #ccc; font-size:13px;">
    <label>
      <p>–ú–∞—Ç–µ—Ä–∏–∞–ª:</p>
      <input type="text" id="extraServiceName" placeholder="–ù–∞–∏–º" style="width:70%; display:inline-block;">
    </label>
    <label>
      <p>–ö–æ–ª-–≤–æ:</p>
      <input type="number" id="extraQuantity" min="0" style="width:70%; display:inline-block;">
    </label>
    <label>
      <p>–ï–¥:</p>
      <select id="extraUnit" style="width:70%; display:inline-block;">
        <option value="—Ç">—Ç</option>
        <option value="–º3">–º3</option>
      </select>
    </label>
    <label>
      <p>–°—É–º–º–∞:</p>
      <input type="number" id="extraAmount" min="0" style="width:70%; display:inline-block;">
    </label>
    <button type="button" onclick="addItem()" style="margin-top:5px;">–î–æ–±–∞–≤–∏—Ç—å</button>
  </div>
  
  <div style="overflow-x:auto;">
    <table id="itemsTable" style="width:100%; margin-top:10px;">
      <thead>
        <tr>
          <th>‚Ññ</th>
          <th>–ú–∞—Ç–µ—Ä–∏–∞–ª</th>
          <th>–ö–æ–ª-–≤–æ</th>
          <th>–ï–¥</th>
          <th>–°—É–º–º–∞, —Ä—É–±.</th>
          <th>—É–¥–∞–ª</th>
        </tr>
      </thead>
      <tbody id="itemsBody"></tbody>
    </table>
  </div>
  
  <!-- –ì–∞–ª–æ—á–∫–∞ –¥–ª—è —Å–∫–∏–¥–∫–∏ -->
  <label style="margin-top:10px; display:flex; justify-content: space-around;">
    <input type="checkbox"  id="discountCheckbox" onchange="updatePreview()"> <span style="margin-left:8px;">5% —Å–∫–∏–¥–∫–∞ –ø—Ä–∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–∏ –∫–∞—Ä—Ç—ã ‚Ññ</span>
  </label>
  
  <button type="button" onclick="downloadPdf()">–°–æ–∑–¥–∞—Ç—å –¥–æ–≥–æ–≤–æ—Ä</button>
  <button type="button" onclick="previewPdf()">–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä</button>
</form>

<div id="pdfPreview"></div>

<script>
let items=[];

// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º —Ç–æ–≤–∞—Ä–æ–≤
function showAddItemForm() {
  document.getElementById('additionalItemForm').style.display='block';
  document.getElementById('extraServiceName').value='';
  document.getElementById('extraQuantity').value='';
  document.getElementById('extraUnit').value='—Ç';
  document.getElementById('extraAmount').value='';
}

function addItem() {
  const name = document.getElementById('extraServiceName').value.trim();
  const quantity = document.getElementById('extraQuantity').value;
  const unit = document.getElementById('extraUnit').value;
  const amount = document.getElementById('extraAmount').value;
  if(!name || !quantity || !amount){
    alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è –¥–ª—è —Ç–æ–≤–∞—Ä–∞/—É—Å–ª—É–≥–∏.');
    return;
  }
  items.push({ serviceName: name, quantity: quantity, unit: unit, amount: amount });
  updateItemsTable();
  document.getElementById('additionalItemForm').style.display='none';
  updatePreview();
}

function updateItemsTable() {
  const tbody=document.getElementById('itemsBody');
  tbody.innerHTML='';
  items.forEach( (item, index)=> {
    const row=document.createElement('tr');

    const cellNum=document.createElement('td');
    cellNum.textContent= index+1;
    row.appendChild(cellNum);

    const cellName=document.createElement('td');
    cellName.textContent= item.serviceName;
    row.appendChild(cellName);

    const cellQty=document.createElement('td');
    cellQty.textContent= item.quantity;
    row.appendChild(cellQty);

    const cellUnit=document.createElement('td');
    cellUnit.textContent= item.unit;
    row.appendChild(cellUnit);

    const cellAmount=document.createElement('td');
    cellAmount.textContent= item.amount;
    row.appendChild(cellAmount);

    const cellAction=document.createElement('td');
    const btnDel=document.createElement('button');
    btnDel.innerHTML='√ó';
    btnDel.className='deleteBtn';
    btnDel.title='–£–¥–∞–ª–∏—Ç—å';
    btnDel.onclick= ()=> {
      items.splice(index,1);
      updateItemsTable();
      updatePreview();
    };
    cellAction.appendChild(btnDel);
    row.appendChild(cellAction);

    tbody.appendChild(row);
  });
}

function getFormData() {
  const serviceName=document.getElementById('serviceName').value.trim();
  const dateInput=document.getElementById('date').value;
  const quantity=document.getElementById('quantity').value;
  const unit=document.getElementById('unit').value;
  const amount=document.getElementById('amount').value;
  const customer=document.getElementById('customer').value.trim();
  const address=document.getElementById('address').value.trim();
  const customerPhone=document.getElementById('customerPhone').value.trim();

  const dateObj=new Date(dateInput);
  if(isNaN(dateObj)){
    alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –¥–∞—Ç—É.');
    return null;
  }

  const options={ day: 'numeric', month: 'long', year: 'numeric' };
  const formattedDate=dateObj.toLocaleDateString('ru-RU', options);
  const day=dateObj.getDate();
  const monthLong=dateObj.toLocaleString('ru-RU',{ month:'long' });
  const year=dateObj.getFullYear();

  return {
    serviceName,
    dateObj,
    formattedDate,
    day,
    monthLong,
    year,
    quantity,
    unit,
    amount,
    customer,
    address,
    customerPhone
  };
}

function getAllItems() {
  const mainServiceName=document.getElementById('serviceName').value.trim();
  const mainQuantity=document.getElementById('quantity').value;
  const mainUnit=document.getElementById('unit').value;
  const mainAmount=document.getElementById('amount').value;

  const allItems=[];

  if(mainServiceName){
    allItems.push({
      serviceName: mainServiceName,
      quantity: mainQuantity,
      unit: mainUnit,
      amount: mainAmount
    });
  }
  allItems.push(...items);
  return allItems;
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –¥–ª—è PDF (—É–±—Ä–∞—Ç—å paddings –∏ margin —Å–≤–µ—Ä—Ö—É)
function buildFullContent(data, items) {
  const totalAmount= items.reduce((sum, item) => sum + Number(item.amount || 0), 0);
  const discountPercent=5;
  const isDiscountApplied=document.getElementById('discountCheckbox').checked;
  const discountAmount= isDiscountApplied ? (totalAmount*discountPercent)/100 : 0;
  const totalWithDiscount= totalAmount - discountAmount;

  const itemsRows= items.map( (item, index)=> `
    <tr>
      <td>${index+1}</td>
      <td>${item.serviceName}</td>
      <td>${item.quantity}</td>
      <td>${item.unit}</td>
      <td>${item.amount}</td>
    </tr>
  `).join('');

  const discountTable = isDiscountApplied ? `
    <table style="width:100%; border-collapse: collapse; margin-top:10px;" border="1" cellpadding="5" cellspacing="0">
      <tbody>
        <tr>
          <td style="text-align:center;">–°—É–º–º–∞ —Å —É—á–µ—Ç–æ–º —Å–∫–∏–¥–∫–∏ –ø—Ä–∏ –∫–∞—Ä—Ç–µ ‚Ññ</td>
          <td style="text-align:center;">${discountPercent}%</td>
          <td style="text-align:center;">${totalWithDiscount.toFixed(2)}</td>
        </tr>
      </tbody>
    </table>
  ` : '';

  const totalSumDisplay = isDiscountApplied ? totalWithDiscount.toFixed(2) : totalAmount.toFixed(2);

  return `
<div style="padding:0 30px">
  <!-- –ù–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å –≤–µ—Ä—Ö–∞, –±–µ–∑ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –æ—Ç—Å—Ç—É–ø–æ–≤ -->
     <div style="display:flex;justify-content: space-between;align-items:center; ">

      
          <div>
            <p style="margin:0;">–ê–ö–¢ ‚Ññ 1 –û–¢ ${data.day} ${data.monthLong} ${data.year} –≥.</p>
            <p style="margin:0;">–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –ò–ü –ú–∏—Ö–∞–π–ª–æ–≤ –ê–ª–µ–∫—Å–∞–Ω–¥—Ä –ê–Ω–¥—Ä–µ–µ–≤–∏—á<br>
            –ò–ù–ù 590613985887 –û–ì–†–ù–ò–ü 305590609000010 —Ç–µ–ª.271-81-41</p>
      
          </div>

          <p>
              ‚òé 8 342 246 12 09<br>
              ‚òé 8 342 271 81 41<br>
              ‚úâ Samosvalchikf@gmail.com<br>
              üåê samosvalchik.rf
          </p>
      </div>


  <!-- –¢–∞–±–ª–∏—Ü–∞ —Ç–æ–≤–∞—Ä–æ–≤ -->
  <div style="style="margin-top:10px;">
    <table style="width:100%; border-collapse: collapse;" border="1" cellpadding="5" cellspacing="0">
      <thead>
        <tr>
          <th>‚Ññ</th>
          <th>–ù–∞–∏–º</th>
          <th>–ö–æ–ª-–≤–æ</th>
          <th>–ï–¥</th>
          <th>–°—É–º–º–∞</th>
        </tr>
      </thead>
      <tbody>
        ${itemsRows}
      </tbody>
      ${discountTable}
    </table>
  </div>

  <!-- –ò—Ç–æ–≥ -->
  <p>–û–±—â–∞—è —Å—É–º–º–∞ –±–µ–∑ —Å–∫–∏–¥–∫–∏ –∏ –ù–î–°: <u>${totalAmount.toFixed(2)}</u> —Ä—É–±.</p>
  <p>–ò–¢–û–ì: <u>${totalSumDisplay}</u> —Ä—É–±.</p>

  <p>–í—ã—à–µ–ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–Ω—ã–µ —É—Å–ª—É–≥–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏ –≤ —Å—Ä–æ–∫. –ó–∞–∫–∞–∑—á–∏–∫ –ø—Ä–µ—Ç–µ–Ω–∑–∏–π –ø–æ –æ–±—ä–µ–º—É, –∫–∞—á–µ—Å—Ç–≤—É –∏ —Å—Ä–æ–∫–∞–º –æ–∫–∞–∑–∞–Ω–∏—è —É—Å–ª—É–≥ –Ω–µ –∏–º–µ–µ—Ç.</p>



  <div style="display:flex; justify-content: space-between; margin-top:20px; width:100%;">
    <div style="width:45%; display:flex;">
      <div>–í–û–î–ò–¢–ï–õ–¨ <br>–ò–°–ü–û–õ–ù–ò–¢–ï–õ–¨  <br> –õ–û–ì–ò–°–¢</div>
      <div style="border-top:1px solid #000; margin-top:10px;width:120%">&nbsp;</div>
      
    </div>
    <div style="width:45%; text-align:center;">
      <div style="border-top:1px solid #000; margin-top:10px;">&nbsp;</div>
      <div>–ó–ê–ö–ê–ó–ß–ò–ö</div>
    </div>
  </div>

  <p style="margin-top:10px;">*–ü—Ä–æ—Å–∏–º –æ—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å:</p>
  
  <div style="display:flex">
      <div>–û—Ç–∫—É–¥–∞ —É–∑–Ω–∞–ª–∏ –æ –Ω–∞—à–µ–π –∫–æ–º–ø–∞–Ω–∏–∏?</div>
      <div>__________________________________________________</div>
  </div>

  <p style="margin-top:10px;">–ü–µ—Ä–µ–≤–æ–¥ 8-908-271-81-41 –ê–ª–µ–∫—Å–∞–Ω–¥—Ä –ê–Ω–¥—Ä–µ–µ–≤–∏—á –ú.(–°–±–µ—Ä–±–∞–Ω–∫)</p>
</div>
<div style="padding:0 30px">
  
  <!-- –ù–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å –≤–µ—Ä—Ö–∞, –±–µ–∑ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –æ—Ç—Å—Ç—É–ø–æ–≤ -->
  
 <div>_______________________________________________________________________________________________</div>
      
          <div>
            <p style="margin:10;">–ê–ö–¢ ‚Ññ 1 –û–¢ ${data.day} ${data.monthLong} ${data.year} –≥.</p>
            <p style="margin:0;">–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –ò–ü –ú–∏—Ö–∞–π–ª–æ–≤ –ê–ª–µ–∫—Å–∞–Ω–¥—Ä –ê–Ω–¥—Ä–µ–µ–≤–∏—á<br>
            –ò–ù–ù 590613985887 –û–ì–†–ù–ò–ü 305590609000010 —Ç–µ–ª.271-81-41</p>
      
          </div>

      


  <!-- –¢–∞–±–ª–∏—Ü–∞ —Ç–æ–≤–∞—Ä–æ–≤ -->
  <div style="style="margin-top:10px;">
    <table style="width:100%; border-collapse: collapse;" border="1" cellpadding="5" cellspacing="0">
      <thead>
        <tr>
          <th>‚Ññ</th>
          <th>–ù–∞–∏–º</th>
          <th>–ö–æ–ª-–≤–æ</th>
          <th>–ï–¥</th>
          <th>–°—É–º–º–∞</th>
        </tr>
      </thead>
      <tbody>
        ${itemsRows}
      </tbody>
      ${discountTable}
    </table>
  </div>

  <!-- –ò—Ç–æ–≥ -->
  <p>–û–±—â–∞—è —Å—É–º–º–∞ –±–µ–∑ —Å–∫–∏–¥–∫–∏ –∏ –ù–î–°: <u>${totalAmount.toFixed(2)}</u> —Ä—É–±.</p>
  <p>–ò–¢–û–ì: <u>${totalSumDisplay}</u> —Ä—É–±.</p>

  <p>–í—ã—à–µ–ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–Ω—ã–µ —É—Å–ª—É–≥–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏ –≤ —Å—Ä–æ–∫. –ó–∞–∫–∞–∑—á–∏–∫ –ø—Ä–µ—Ç–µ–Ω–∑–∏–π –ø–æ –æ–±—ä–µ–º—É, –∫–∞—á–µ—Å—Ç–≤—É –∏ —Å—Ä–æ–∫–∞–º –æ–∫–∞–∑–∞–Ω–∏—è —É—Å–ª—É–≥ –Ω–µ –∏–º–µ–µ—Ç.</p>



  <div style="display:flex; justify-content: space-between; margin-top:20px; width:100%;">
    <div style="width:45%; display:flex;">
      <div>–í–û–î–ò–¢–ï–õ–¨ <br>–ò–°–ü–û–õ–ù–ò–¢–ï–õ–¨  <br> –õ–û–ì–ò–°–¢</div>
      <div style="border-top:1px solid #000; margin-top:10px;width:120%">&nbsp;</div>
      
    </div>
    <div style="width:45%; text-align:center;">
      <div style="border-top:1px solid #000; margin-top:10px;">&nbsp;</div>
      <div>–ó–ê–ö–ê–ó–ß–ò–ö</div>
    </div>
  </div>

  

  <p style="margin-top:10px;">–ü–µ—Ä–µ–≤–æ–¥ 8-908-271-81-41 –ê–ª–µ–∫—Å–∞–Ω–¥—Ä –ê–Ω–¥—Ä–µ–µ–≤–∏—á –ú.(–°–±–µ—Ä–±–∞–Ω–∫)</p>
</div>
`;
}

function getFormData() {
  const serviceName = document.getElementById('serviceName').value.trim();
  const dateInput = document.getElementById('date').value;
  const quantity = document.getElementById('quantity').value;
  const unit = document.getElementById('unit').value;
  const amount = document.getElementById('amount').value;
  const customer = document.getElementById('customer').value.trim();
  const address = document.getElementById('address').value.trim();
  const customerPhone = document.getElementById('customerPhone').value.trim();

  const dateObj = new Date(dateInput);
  if (isNaN(dateObj)) {
    alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –¥–∞—Ç—É.');
    return null;
  }

  const options = { day: 'numeric', month: 'long', year: 'numeric' };
  const formattedDate = dateObj.toLocaleDateString('ru-RU', options);
  const day = dateObj.getDate();
  const monthLong = dateObj.toLocaleString('ru-RU', { month: 'long' });
  const year = dateObj.getFullYear();

  return {
    serviceName,
    dateObj,
    formattedDate,
    day,
    monthLong,
    year,
    quantity,
    unit,
    amount,
    customer,
    address,
    customerPhone
  };
}

function getAllItems() {
  const mainServiceName = document.getElementById('serviceName').value.trim();
  const mainQuantity = document.getElementById('quantity').value;
  const mainUnit = document.getElementById('unit').value;
  const mainAmount = document.getElementById('amount').value;

  const allItems = [];
  if (mainServiceName) {
    allItems.push({
      serviceName: mainServiceName,
      quantity: mainQuantity,
      unit: mainUnit,
      amount: mainAmount
    });
  }
  allItems.push(...items);
  return allItems;
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è PDF
function updatePreview() {
  const data = getFormData();
  if (!data) return;
  const allItems = getAllItems();

  const content = buildFullContent(data, allItems);
  const container = document.getElementById('pdfPreview');
  container.innerHTML = '';

  const el = document.createElement('div');
  el.innerHTML = content;

  const options = {
    margin: 0,
    html2canvas: { scale: 2, dpi: 300, useCORS: true },
    jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
  };

  html2pdf().set(options).from(el).toPdf().then(function(pdfBlob) {
    const url = URL.createObjectURL(pdfBlob);
    const iframe = document.createElement('iframe');
    iframe.src = url;
    iframe.style.width = '100%';
    iframe.style.height = '80vh';
    iframe.style.border = 'none';
    container.innerHTML = '';
    container.appendChild(iframe);
  }).catch(function(error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ PDF:', error);
    alert('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä PDF. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.');
  });
}

function downloadPdf() {
  const data = getFormData();
  if (!data) return;
  const allItems = getAllItems();
  const content = buildFullContent(data, allItems);
  const el = document.createElement('div');
  el.innerHTML = content;
  html2pdf().set({
    margin: 0,
    html2canvas: { scale: 2, dpi: 300, useCORS: true }
  }).from(el).save(`–ê–∫—Ç_${data.formattedDate}.pdf`);
}
</script>
</body>
</html>
